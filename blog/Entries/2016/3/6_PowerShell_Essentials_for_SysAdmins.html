<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="Generator" content="iWeb 3.0.2" />
    <meta name="iWeb-Build" content="local-build-20190818" />
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <meta name="viewport" content="width=700" />
    <title>PowerShell Essentials for SysAdmins</title>
    <link rel="stylesheet" type="text/css" media="screen,print" href="6_PowerShell_Essentials_for_SysAdmins_files/6_PowerShell_Essentials_for_SysAdmins.css" />
    <!--[if lt IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='6_PowerShell_Essentials_for_SysAdmins_files/6_PowerShell_Essentials_for_SysAdminsIE.css'/><![endif]-->
    <!--[if gte IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='../../../../Media/IE8.css'/><![endif]-->
    <script language="javascript" type="text/javascript"><!--

iWebBlogMainPageName = 'blog.html';
iWebBlogMainPageTitle = 'blog';
iWebBlogArchivePageName = 'Archive.html';
iWebBlogArchivePageTitle = 'Archive';


--></script>
    <script type="text/javascript" src="../../../../Scripts/iWebSite.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Widgets/SharedResources/WidgetCommon.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Widgets/Navbar/navbar.js"></script>
    <script type="text/javascript" src="http://www.me.com/1/up/comments/scripts/search.js"></script>
    <script type="text/javascript" src="../../../../Scripts/iWebBlog.js"></script>
    <script type="text/javascript" src="../../../../Scripts/iWebImage.js"></script>
    <script type="text/javascript" src="6_PowerShell_Essentials_for_SysAdmins_files/6_PowerShell_Essentials_for_SysAdmins.js"></script>
  </head>
  <body style="background: rgb(247, 246, 246); margin: 0pt; " onload="onPageLoad();" onunload="onPageUnload();">
    <div style="text-align: center; ">
      <div style="margin-bottom: 0px; margin-left: auto; margin-right: auto; margin-top: 0px; overflow: hidden; position: relative; word-wrap: break-word;  background: rgb(247, 246, 246); text-align: left; width: 700px; " id="body_content">
        <div style="float: left; height: 0px; line-height: 0px; margin-left: 0px; position: relative; width: 700px; z-index: 10; " id="header_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
        </div>
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 0; " id="nav_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div style="height: 1px; line-height: 1px; " class="tinyText"> </div>
          <div class="com-apple-iweb-widget-navbar flowDefining" id="widget0" style="margin-left: 0px; margin-top: 24px; opacity: 1.00; position: relative; width: 700px; z-index: 1; ">
    
            <div id="widget0-navbar" class="navbar">

      
              <div id="widget0-bg" class="navbar-bg">

        
                <ul id="widget0-navbar-list" class="navbar-list">
 <li></li> 
</ul>
                
      
</div>
              
    
</div>
          </div>
          <script type="text/javascript"><!--//--><![CDATA[//><!--
new NavBar('widget0', '../../../../Scripts/Widgets/Navbar', '../../../../Scripts/Widgets/SharedResources', '../../../..', {"path-to-root": "..\/..\/..\/..\/", "navbar-css": ".navbar {\n\tfont-family: 'Helvetica Neue', Arial, sans-serif;\n\tfont-size: .85em;\n\tcolor: #999;\n\tmargin: 0px;\n\tline-height: 20px;\n\tfont-weight: bold;\n}\n\n.navbar-bg {\n\ttext-align: left;\n\tpadding: 0px;\n}\n\n.navbar-bg ul {\n\tlist-style: none;\n\tmargin: 0px;\n\tpadding: 0px;\n}\n\n\nli {\n\tlist-style-type: none;\n\tdisplay: inline;\n\tpadding: 0px 15px 0px 10px;\n}\n\n\nli a {\n\ttext-decoration: none;\n\tcolor: #999;\n}\n\nli a:visited {\n\ttext-decoration: none;\n\tcolor: #999;\n}\n\nli a:hover\n{\n \tcolor: #F00;\n\ttext-decoration: none;\n}\n\n\nli.current-page a\n{\n\t color: #666;\n\ttext-decoration: none;\n\n}", "current-page-GUID": "3F9CBE75-F5BD-4B35-9E50-35A3B3B60A4E", "isCollectionPage": "YES"});
//--><!]]></script>
          <div style="clear: both; height: 0px; line-height: 0px; " class="spacer"> </div>
        </div>
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 5; " id="body_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id1" style="visibility: hidden;  height: 41px; left: 40px; position: absolute; top: 416px; width: 620px; z-index: 1; " class="style_SkipStroke shape-with-text">
            <div class="text-content Normal_External_620_41" style="padding: 0px; ">
              <div class="Normal">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Title"><span class="Color">PowerShell Essentials for SysAdmins</span></p>
              </div>
            </div>
            <div id="generic-title-attributes" class="Title"></div>
          </div>
          


          <div id="id2" style="visibility: hidden;  height: 41px; left: 40px; position: absolute; top: 448px; width: 620px; z-index: 1; " class="style_SkipStroke_1 shape-with-text">
            <div class="text-content style_External_620_41" style="padding: 0px; ">
              <div class="style">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Date">Sunday, March 6, 2016</p>
              </div>
            </div>
            <div id="generic-datefield-attributes" class="Date"></div>
          </div>
          <div style="height: 1px; line-height: 1px; " class="tinyText"> </div>
          <div style="visibility: hidden;  margin-left: 40px; margin-top: 488px; position: relative; width: 620px; z-index: 1; " class="style_SkipStroke_3 shape-with-text flowDefining">
            <div class="text-content style_External_620_7506" style="padding: 0px; ">
              <div class="style">
                <p style="padding-top: 0pt; " class="Body">Last week, I gave a presentation entitled “The Practical Guide to PowerShell” to the local IT user group (WWITPRO) that went over very well - as a result, this blog post will summarize some of the stuff from that presentation!<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">PowerShell is essentially a scripting language and shell (command prompt) that you can use on Windows systems.  It’s basically Microsoft’s way of getting a powerful UNIX/Linux/Mac-like shell on the Windows platform (long overdue!).  The first versions of PowerShell were pretty horrific, but it’s come a long way since then.  PowerShell v4 and later is pretty decent (Win10 comes with PowerShell v5).  Luckily, PowerShell v4 comes with Windows Server 2012, and since this post is geared towards sysadmins, I’ll focus everything on Windows Server 2012.<br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style">1. PowerShell Basics<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">When you open up PowerShell (it’s next to your Start button on the taskbar in Windows Server 2012), you’ll get a PS prompt where you can type commands:<br /></p>
                <div class="paragraph Body"><div style="height: 320px; width: 538px;  height: 320px; position: relative; width: 538px; " class="tinyText style_SkipStroke_2 inline-block stroke_0 shadow_0"><img src="6_PowerShell_Essentials_for_SysAdmins_files/droppedImage.jpg" alt="" style="border: none; height: 320px; width: 538px; " /></div><br /></div>
                <p class="Body"><br /></p>
                <p class="Body">It’s important to note that most DOS commands will work fine within a PowerShell window - try these for example:<br /></p>
                <p class="paragraph_style_1"><span class="style_1">cls<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">echo Hello World<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">cd \<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">copy c:\windows\system32\calc.exe C:\<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">mkdir C:\stuff<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">ipconfig &gt; lala.txt<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">notepad lala.txt<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">ipconfig ; dir ; date</span><br /></p>
                <p class="Body"><br /></p>
                <p class="Body">However, some DOS commands will not work - specifically those that interface directly with the OS as there is a PowerShell equivalent of doing that:<br /></p>
                <p class="Body"><span class="style_2">path</span>&lt;--Doesn’t work!<br /></p>
                <p class="Body"><span class="style_2">$env:Path</span> &lt;--This is the way to call the PATH environment variable in PowerShell<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Commands in PowerShell are called cmdlets, and have an <span class="style_3">action-object</span> naming convention (e.g. <span class="style_2">Get-Help</span>).  And just like DOS, commands are <span class="style_3">case-insensitive</span>, and the <span class="style_3">Tab key</span> will auto-complete commands/paths as you type them in (in PowerShell, the Tab key will also auto-complete command options!). <br /></p>
                <p class="Body"><br /></p>
                <p class="Body">However, other features of PowerShell mimic those in a UNIX/Linux/Mac shell (such as BASH).  For example, output from one command can be <span class="style_3">piped</span> to another command for processing data, or formatting/reducing output:<br /></p>
                <p class="paragraph_style_1"><span class="style_1">Get-host<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">Get-host | format-list version <br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">Get-host | fl version<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">Get-host | ft version</span><br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Similarly, cmdlets can have <span class="style_3">aliases</span> to them to save typing.  For example, <span class="style_2">help</span> is an alias to the cmdlet <span class="style_2">Get-Help</span>. Try these out:<br /></p>
                <p class="Body"><span class="style_2">Get-alias <br /></span></p>
                <p class="Body"><span class="style_2">Get-alias –name f<br /></span></p>
                <p class="Body"><span class="style_2">Get-alias –definition format-list<br /></span></p>
                <p class="Body"><span class="style_2">Get-alias –definition get-alias<br /></span></p>
                <p class="Body"><span class="style_2">Alias</span><span class="style_4"> </span> &lt;-- Same as gal / get-alias (UNIX style)<br /></p>
                <p class="Body"><span class="style_2">Ls</span> &lt;-- Ditto<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">To get a list of cmdlets and help on those cmdlets, you could try these:<br /></p>
                <p class="paragraph_style_2">Get-command <br /></p>
                <p class="paragraph_style_2">Get-command | more<br /></p>
                <p class="paragraph_style_2">Get-command | measure-object –line<br /></p>
                <p class="paragraph_style_2">Get-help measure-object<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">However, if you come from a UNIX/Linux/Mac environment, not everything will work as expected since PowerShell is an additional component to the Windows OS (not an underlying component) - as a result, cmdlets must explicitly be written to support every possible operation.  For example, let’s take the <span class="style_2">Select-String</span><span class="style_3"> </span>cmdlet (which is equivalent to UNIX <span class="style_2">grep</span>):<br /></p>
                <p class="Body"><span class="style_2">Get-host | fl version  | select-string -pattern “4.0“</span><span class="style_4"> </span><span class="style_1"> </span>&lt;--BAD!<br /></p>
                <p class="Body"><span class="style_2">dir –r C:\Stuff | sls “space“</span><span class="style_5">  </span>&lt;-- create text file with space in it under C:\Stuff<br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style">2. PowerShell Providers &amp; Members<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">PowerShell has different “dimensions” that it can work with like drive letters - for example, <br /></p>
                <p class="Body">Filesystem (default), certificates, registry, etc.  Each dimension is called a <span class="style_3">PowerShell provider </span>and is treated like a DOS drive letter.  Try the following out:<br /></p>
                <p class="paragraph_style_3"><span class="style_5">Get-psprovider<br /></span></p>
                <p class="paragraph_style_3"><span class="style_5">Get-psdrive<br /></span></p>
                <p class="paragraph_style_3"><span class="style_5">Gdr<br /></span></p>
                <p class="paragraph_style_3"><span class="style_5">Set-location alias:<br /></span></p>
                <p class="paragraph_style_3"><span class="style_5">Dir</span> (or <span class="style_5">gci</span>)<br /></p>
                <p class="paragraph_style_2">Sl cert:<br /></p>
                <p class="paragraph_style_2">Dir <br /></p>
                <p class="paragraph_style_2">Sl HKCU:<br /></p>
                <p class="paragraph_style_2">Dir <br /></p>
                <p class="paragraph_style_2">Cd Software<br /></p>
                <p class="paragraph_style_2">Dir <br /></p>
                <p class="paragraph_style_2">Cd Google<br /></p>
                <p class="paragraph_style_2">Dir <br /></p>
                <p class="paragraph_style_2">Sl c:<br /></p>
                <p class="paragraph_style_2">Dir <br /></p>
                <p class="paragraph_style_2">Dir -Force <br /></p>
                <p class="paragraph_style_2">Remove-Item C:\directory –Recurse<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Everything within a PowerShell provider (files, directories, certificates, registry keys, etc.) are treated as <span class="style_3">member objects</span>, and each object has properties.  You can simply pipe objects to <span class="style_2">Get-Member</span> (<span class="style_2">gm</span>) to see these properties, as well as use <span class="style_2">Get-ItemProperty</span> (<span class="style_2">gp</span>) and <span class="style_2">Set-ItemProperty</span> (<span class="style_2">sp</span>) to view and change them.  Try this out:<br /></p>
                <p class="Body"><span class="style_2">Gci somefile<br /></span></p>
                <p class="Body"><span class="style_2">Gci somefile | gm<br /></span></p>
                <p class="Body"><span class="style_2">Gp somefile<br /></span></p>
                <p class="Body"><span class="style_2">Gp somefile | fl CreationTime<br /></span></p>
                <p class="Body"><span class="style_2">Sp somefile CreationTime</span> &lt;--put in some date when prompted (e.g. 1/1/2016)<br /></p>
                <p class="paragraph_style_2">gci C:\Stuff -Recurse | where {$_.LastWriteTime –gt &quot;02/01/2016&quot;}<br /></p>
                <p class="Body"> <br /></p>
                <p class="Body">Here is some extra stuff to drill in how object-oriented PowerShell really is:<br /></p>
                <p class="Body"><span class="style_2">$a = gci somefile<br /></span></p>
                <p class="Body"><span class="style_2">$a<br /></span></p>
                <p class="Body"><span class="style_2">$a.isreadonly<br /></span></p>
                <p class="Body"><span class="style_2"><br /></span></p>
                <p class="Body"><span class="style_2">$itunes = new-object -com itunes.application</span><span class="style_5"> </span> &lt;--install iTunes first &amp; add song<br /></p>
                <p class="paragraph_style_2">$itunes.play()<br /></p>
                <p class="paragraph_style_2">$itunes.stop()<br /></p>
                <p class="paragraph_style_2">$itunes | gm<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">$ui = (Get-Host).UI.RawUI<br /></p>
                <p class="paragraph_style_2">$ui.WindowTitle = &quot;Extreme PowerShell Window!&quot;<br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_4">3. Useful Cmdlets for Daily System Administration<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Although most Windows sysadmins typically RDP into a server to administer it graphically, there are a few tasks that save you time if you do them in PowerShell!  Here are some of my favorites by topic area (try them out for yourself to see how cool they are):<br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_5">Network Admin cmdlets:<br /></p>
                <p class="paragraph_style_2">Test-NetConnection<br /></p>
                <p class="paragraph_style_2">Test-NetConnection triosdevelopers.com –Traceroute<br /></p>
                <p class="paragraph_style_2">Test-NetConnection triosdevelopers.com –Port 443<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Get-NetIPConfiguration<br /></p>
                <p class="paragraph_style_2">Get-NetAdapter<br /></p>
                <p class="paragraph_style_2">Get-NetAdapterStatistics<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">New-NetIPAddress –InterfaceAlias Ethernet –IPAddress 192.168.1.50 <br /></p>
                <p class="paragraph_style_2">  –PrefixLength 24 –DefaultGateway 192.168.1.1<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Set-DNSClientServerAddress –InterfaceAlias Ethernet <br /></p>
                <p class="paragraph_style_2">  –ServerAddresses 8.8.8.8<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Set-NetFirewallProfile –profile domain,public,private –Enabled false<br /></p>
                <p class="paragraph_style_2"> <br /></p>
                <p class="paragraph_style_2">New-NetFirewallRule –DisplayName “Allow Inbound 80 TCP” <br /></p>
                <p class="paragraph_style_2">  –Direction Inbound –Localport 80 –Protocol TCP –Action Allow<br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_5">System Admin cmdlets:<br /></p>
                <p class="paragraph_style_6"><span class="style_5">gwmi Win32_ComputerSystem<br /></span></p>
                <p class="paragraph_style_7"><span class="style_5"><br /></span></p>
                <p class="paragraph_style_7"><span class="style_2">Get-Service | ogv</span><span class="style_1"> </span>  <span class="style_6">&lt;-- Out-Gridview</span><br /></p>
                <p class="paragraph_style_7"><span class="style_2">Restart-Service dnscache </span><span class="style_6">&lt;-- also stop/start/set-service<br /></span></p>
                <p class="paragraph_style_7"><span class="style_2">ps | sort –property cpu | select –last 5</span><span class="style_5"> </span><span class="style_6">&lt;-- ps = get-process<br /></span></p>
                <p class="paragraph_style_7"><span class="style_2">Stop-process –name iTunes </span><span class="style_5"><br /></span></p>
                <p class="paragraph_style_7"><span class="style_5"><br /></span></p>
                <p class="paragraph_style_7"><span class="style_2">Rename-Computer name<br /></span></p>
                <p class="paragraph_style_7"><span class="style_2">Restart-Computer</span> <span class="style_6">(pipe text file with names to cmdlet to reboot many computers)<br /></span></p>
                <p class="paragraph_style_2">Stop-Computer<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Add-Computer –DomainName domain.com<br /></p>
                <p class="paragraph_style_2">Test-ComputerSecureChannel <br /></p>
                <p class="paragraph_style_2">Test-ComputerSecureChannel –credential domain\administrator –Repair  <br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Get-WindowsFeature | ogv<br /></p>
                <p class="paragraph_style_2">Install-WindowsFeature –IncludeAllSubfeature <br /></p>
                <p class="paragraph_style_2">  –IncludeManagementTools web-server<br /></p>
                <p class="paragraph_style_2">Install-WindowsFeature Net-Framework-Core –Source e:\sources\sxs<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Get-Hotfix | ogv<br /></p>
                <p class="paragraph_style_7"><br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_5">VM (2012/8+) cmdlets:<br /></p>
                <p class="paragraph_style_2">Copy  X:\2012Template.vhdx   X:\VMs\2012VM.vhdx<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">New-VM –MemoryStartupBytes 4096MB –Name 2012VM –Path “X:\VMs” <br /></p>
                <p class="paragraph_style_2">  –VHDPath “X:\VMs\2012VM.vhdx” (existing VHDX file sysprepped)<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Get-VM –Name 2012VM | Get-VMNetworkAdapter | Connect-VMNetworkAdapter <br /></p>
                <p class="paragraph_style_2">  –Switchname “External Network”<br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_5">AD Administration cmdlets:<br /></p>
                <p class="paragraph_style_2">Search-ADAccount –PasswordNeverExpires | ogv<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Get-ADForest domain.com | FT SchemaMaster<br /></p>
                <p class="paragraph_style_2">Get-ADDomain domain.com | FT PDCEmulator<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Move-ADDirectoryServerOperationsMasterRole –Identity NewDCName <br /></p>
                <p class="paragraph_style_2">  –OperationsMasterRole SchemaMaster,RIDMaster -Force<br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_5">Remote management cmdlets:<br /></p>
                <p class="Body">(best when run as a Domain Admin within a domain environment)<br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_2">Restart-Computer –Force –ComputerName exchange.lala.com<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Enter-PSSession targetmachine<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">Invoke-Command -Computername machine1, machine2 <br /></p>
                <p class="paragraph_style_2">  -Filepath c:\Script\script.ps1<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Note that remote management requires winRM (started by default in Windows Server 2012) - if it is not enabled, you could run<span class="style_3"> </span><span class="style_2">winrm -quickconfig</span>, or:<br /></p>
                <p class="paragraph_style_1"><span class="style_1">Set-Service winrm –StartupType automatic<br /></span></p>
                <p class="paragraph_style_1"><span class="style_1">Enable-PSRemoting –Force</span><br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_4">4. PowerShell Scripts<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Any of the cmdlets discussed previously could be placed into a PowerShell script and executed on the system.  However, you must first make sure that your execution policy allows for script execution by executing the <span class="style_2">Get-ExecutionPolicy</span> cmdlet.  Here is a description of the different policies:<br /></p>
                <ol>
                  <li style="line-height: 20px; padding-left: 30px; text-indent: -20px; " class="full-width">
                    <p style="text-indent: -20px; " class="paragraph_style_8"><span style="font-size: 14px; " class="Bullet">•</span><span style="width: 15px; " class="inline-block"></span><span class="style_3">Restricted</span> (disabled - default on clients)<br /></p>
                  </li>
                  <li style="line-height: 20px; padding-left: 30px; text-indent: -20px; " class="full-width">
                    <p style="text-indent: -20px; " class="paragraph_style_8"><span style="font-size: 14px; " class="Bullet">•</span><span style="width: 15px; " class="inline-block"></span><span class="style_3">AllSigned</span> (all scripts must be signed)<br /></p>
                  </li>
                  <li style="line-height: 20px; padding-left: 30px; text-indent: -20px; " class="full-width">
                    <p style="text-indent: -20px; " class="paragraph_style_8"><span style="font-size: 14px; " class="Bullet">•</span><span style="width: 15px; " class="inline-block"></span><span class="style_3">RemoteSigned</span> (all scripts downloaded from the Internet must be signed - the default on Windows Server 2012)<br /></p>
                  </li>
                  <li style="line-height: 20px; padding-left: 30px; text-indent: -20px; " class="full-width">
                    <p style="text-indent: -20px; " class="paragraph_style_8"><span style="font-size: 14px; " class="Bullet">•</span><span style="width: 15px; " class="inline-block"></span><span class="style_3">Unrestricted</span> (all scripts run, you’re prompted to continue for unsigned Internet scripts)<br /></p>
                  </li>
                  <li style="line-height: 20px; padding-left: 30px; text-indent: -20px; " class="full-width">
                    <p style="text-indent: -20px; " class="paragraph_style_8"><span style="font-size: 14px; " class="Bullet">•</span><span style="width: 15px; " class="inline-block"></span><span class="style_3">Bypass</span> (all scripts run)<br /></p>
                  </li>
                </ol>
                <p class="Body"><br /></p>
                <p class="Body">If you wanted to allow all scripts to run, you could execute <span class="style_2">Set-ExecutionPolicy Unrestricted</span> (this can also be set with a GPO in a domain to hit multiple computers).<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">PowerShell scripts are simply text files with a <span class="style_3">.ps1</span> extension - they can be edited in <span class="style_3">Notepad</span>, but the default editor application for them is <span class="style_3">PowerShell Integrated Scripting Environment (ISE)</span>,which color codes different parts of the script (useful for testing).  <br /></p>
                <p class="Body"><br /></p>
                <p class="Body">To execute a script that you created from a PowerShell prompt, simply specify the relative or absolute path to the script - for example:<br /></p>
                <p class="paragraph_style_2">./myscript.ps1  <br /></p>
                <p class="paragraph_style_2">.\myscript.ps1 <br /></p>
                <p class="paragraph_style_2">c:\myscript.ps1 <br /></p>
                <p class="Body"><br /></p>
                <p class="Body">You can also execute PowerShell scripts outside PowerShell (e.g. within a task in Task Scheduler) by calling the PowerShell interpreter first - for example:<br /></p>
                <p class="paragraph_style_2">PowerShell.exe c:\myscript.ps1 <br /></p>
                <p class="Body"><br /></p>
                <p class="Body">As long as you can read (trace) a PowerShell script, you can copy &amp; modify scripts on the Internet to suit your needs!  The scripts you create can be basic ones that perform a series of tasks using DOS commands or PowerShell cmdlets (much like a simple batch file):<br /></p>
                <p class="Body"> <br /></p>
                <p class="paragraph_style_2">#Remove logs from the night before<br /></p>
                <p class="paragraph_style_2">del \\server1\archive\acctlog_sorted.txt<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">#Sorts acclog.txt, removes any duplicate lines, and saves it to<br /></p>
                <p class="paragraph_style_2">#acclog_sorted.txt.<br /></p>
                <p class="paragraph_style_2">$TextFile = &quot;C:\LogStorage\acctlog.txt&quot;<br /></p>
                <p class="paragraph_style_2">$NewTextFile = &quot;C:\LogStorage\acclog_sorted.txt&quot;<br /></p>
                <p class="paragraph_style_2">Get-Content $TextFile | Sort-Object | Get-Unique &gt; $NewTextFile<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">#Copy unique sorted accounting log over to archive<br /></p>
                <p class="paragraph_style_2">xcopy /s/e/v C:\LogStorage\acctlog.txt \\server1\archive<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">#Remove old accounting logs<br /></p>
                <p class="paragraph_style_2">del c:\LogStorage\acclog_sorted.txt<br /></p>
                <p class="paragraph_style_2">del c:\LogStorage\acclog.txt <br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Or it could use more complex programming constructs (if, switch, for foreach, while, until, functions, and so on):<br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_2">#This script uses the .NET method to ping servers listed in the<br /></p>
                <p class="paragraph_style_2">#$arrayComputer array #variable – if the computer is pingable, it<br /></p>
                <p class="paragraph_style_2">#renames the Administrator account to bob.<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">$arrayComputer = &quot;10.3.101.2&quot;,&quot;10.3.101.3&quot;,&quot;10.3.101.4&quot;<br /></p>
                <p class="paragraph_style_2">Foreach ($strComputer in $arrayComputer) {<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">$ping = new-object System.Net.NetworkInformation.Ping<br /></p>
                <p class="paragraph_style_2">$Reply = $ping.send($strComputer)<br /></p>
                <p class="paragraph_style_2">if($Reply.status -eq &quot;success&quot;)<br /></p>
                <p class="paragraph_style_2">        {<br /></p>
                <p class="paragraph_style_2">$admin=[adsi](&quot;WinNT://&quot; + $strComputer + &quot;/administrator, user&quot;)<br /></p>
                <p class="paragraph_style_2">$admin.psbase.rename(&quot;bob&quot;)<br /></p>
                <p class="paragraph_style_2">          }<br /></p>
                <p class="paragraph_style_2">}<br /></p>
                <p class="paragraph_style_6"><br /></p>
                <p class="Body">And, of course, you can write scripts many different ways - here is a very similar script:<br /></p>
                <p class="paragraph_style_1"><br /></p>
                <p class="paragraph_style_2">#This script uses the .NET method to ping servers for a whole network <br /></p>
                <p class="paragraph_style_2">#If the computer #is pingable, it renames the Administrator account to<br /></p>
                <p class="paragraph_style_2">#bob and displays total changes.<br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">write-host &quot;Now Pinging IP's ... please be patient&quot; <br /></p>
                <p class="paragraph_style_2">$ping = New-Object System.Net.NetworkInformation.Ping <br /></p>
                <p class="paragraph_style_2">$i = 0 <br /></p>
                <p class="paragraph_style_2">1..255 | foreach { $ip = &quot;10.3.101.$_&quot;  <br /></p>
                <p class="paragraph_style_2">$Res = $ping.send($ip) <br /></p>
                <p class="paragraph_style_2"> <br /></p>
                <p class="paragraph_style_2">if ($Res.Status -eq &quot;Success&quot;) { <br /></p>
                <p class="paragraph_style_2">         $admin=[adsi](&quot;WinNT://&quot; + $ip + &quot;/administrator, user&quot;)<br /></p>
                <p class="paragraph_style_2">        $admin.psbase.rename(&quot;bob&quot;)   <br /></p>
                <p class="paragraph_style_2">        $i++ <br /></p>
                <p class="paragraph_style_2">         } <br /></p>
                <p class="paragraph_style_2">} <br /></p>
                <p class="paragraph_style_2">  <br /></p>
                <p class="paragraph_style_2">[string]$i + &quot; Hosts have been modified&quot; <br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Enough reading!  Try the script below out - simply paste it into Notepad, save it as myscript.ps1 and execute it:<br /></p>
                <p class="paragraph_style_2"> <br /></p>
                <p class="paragraph_style_2">#This script displays the system uptime <br /></p>
                <p class="paragraph_style_2">#Convert WMI date to TimeDate object<br /></p>
                <p class="paragraph_style_2">&quot;&quot; <br /></p>
                <p class="paragraph_style_2">function WMIDateStringToDate($Bootup) { <br /></p>
                <p class="paragraph_style_2">[System.Management.ManagementDateTimeconverter]::ToDateTime($Bootup) <br /></p>
                <p class="paragraph_style_2">} <br /></p>
                <p class="paragraph_style_2"> <br /></p>
                <p class="paragraph_style_2">#Set $Computer to multiple IPs/names to analyze multiple computers<br /></p>
                <p class="paragraph_style_2">$Computer = &quot;.&quot;   #adjust as needed to include multiple computers <br /></p>
                <p class="paragraph_style_2">$computers = Get-WMIObject -class Win32_OperatingSystem –computer $computer <br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">foreach ($system in $computers) { <br /></p>
                <p class="paragraph_style_2">     $Bootup = $system.LastBootUpTime <br /></p>
                <p class="paragraph_style_2">     $LastBootUpTime = WMIDateStringToDate($Bootup) <br /></p>
                <p class="paragraph_style_2">     $now = Get-Date <br /></p>
                <p class="paragraph_style_2">     $Uptime = $now - $lastBootUpTime <br /></p>
                <p class="paragraph_style_2">     $d = $Uptime.Days <br /></p>
                <p class="paragraph_style_2">     $h = $Uptime.Hours <br /></p>
                <p class="paragraph_style_2">     $m = $uptime.Minutes <br /></p>
                <p class="paragraph_style_2">     $ms= $uptime.Milliseconds <br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2">&quot;System Up for: {0} days, {1} hours, {2}.{3} minutes&quot; -f $d,$h,$m,$ms  <br /></p>
                <p class="paragraph_style_2">} <br /></p>
                <p class="paragraph_style_2">&quot;&quot; <br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_4">5. Getting Comfy with PowerShell<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">On a final note, there are two things that you’ll want to do to make PowerShell a bit more personal for you.  The first thing is to create a custom <span class="style_3">PowerShell console file </span>that has the extension <span class="style_3">.psc1</span> using the following:<br /></p>
                <p class="Body"><span class="style_2">export-console lala</span> (creates lala.psc1)<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Simply double-click the lala.psc1 file to open PowerShell - next, customize your window settings to your liking (color, size, layout, etc.).  Your customizations are saved to the lala.psc1 file automatically and will be there next time you double-click on it!<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">The second thing you’ll want to do is enable and use your <span class="style_3">PowerShell profile</span>. A PowerShell profile is simply a PowerShell script that automatically executes when YOU open PowerShell (sort of like .bash_profile in Linux or .profile on UNIX).  It is stored in your user profile (e.g. C:\Users\bob\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1), and is great for storing custom aliases and functions that make your coding a lot easier!<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">First, create your PowerShell profile:<br /></p>
                <p class="paragraph_style_2">New-Item –path $profile –itemtype file -force<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Next, edit your profile: <br /></p>
                <p class="paragraph_style_2">notepad $profile <br /></p>
                <p class="paragraph_style_2"><br /></p>
                <p class="paragraph_style_2"><span class="style_7">And add the following contents (save your changes when finished):<br /></span></p>
                <p class="paragraph_style_2">Write-host  “Greetings Professor Falken&quot; <br /></p>
                <p class="paragraph_style_2">Set-alias  c  clear-host<br /></p>
                <p class="paragraph_style_2">Function pro {write-host “Editing PS Profile”; start-sleep –s 2; <br /></p>
                <p class="paragraph_style_2">   notepad $profile}<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Close your PowerShell window, open it again, and notice the greeting!  Try typing <span class="style_2">c</span> and <span class="style_2">pro</span> to test your alias and function.<br /></p>
                <p class="Body"><br /></p>
                <p style="padding-bottom: 0pt; " class="Body">That’s it for this blog post - I hope you enjoyed it!</p>
              </div>
              <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText"> </div>
            </div>
            <div id="generic-body-attributes" class="Body"></div>
          </div>
          


          <div style="height: 274px; width: 700px;  height: 274px; left: 0px; position: absolute; top: 63px; width: 700px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 700px; ">
              <img src="6_PowerShell_Essentials_for_SysAdmins_files/shapeimage_1.png" alt="" style="height: 274px; left: 0px; position: absolute; top: 0px; width: 700px; visibility: hidden; " id="generic-picture-attributes" />
            </div>
          </div>
          <div style="height: 0px; line-height: 0px; " class="spacer"> </div>
        </div>
        <div style="height: 150px; margin-left: 0px; position: relative; width: 700px; z-index: 15; " id="footer_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id3" style="height: 30px; left: 350px; position: absolute; top: 30px; width: 310px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_310_30" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Next"><a class="iWebBlogNext" title="" href="">next &gt;</a></p>
              </div>
            </div>
          </div>
          


          <div id="id4" style="height: 30px; left: 40px; position: absolute; top: 30px; width: 310px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_310_30" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Previous"><a class="iWebBlogPrev" title="" href="">&lt; previous</a></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>


