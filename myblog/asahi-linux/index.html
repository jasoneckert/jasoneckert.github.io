<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title>Jason Eckert&#39;s Website and Blog</title>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta name="description" content="My personal website and blog" />
  <meta name="author" content="Jason Eckert" />
  <meta name="generator" content="Jason Eckert Hugo 0.119.0" />

  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Overlock|Roboto+Mono&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/mero.css" />

  <script src="/js/mero.js"></script>
</head>

  <body class="bg-dark text-white m-auto" style="width:95%; max-width: 1024px;">
    <div class="wrapper">
      <nav class="mb-3 mt-3 ml-1">
  <div class="d-flex flex-row">
    <div
      class="menu-item border border-warning bg-dark p-2"
      style="border-top-left-radius: 10px; border-bottom-left-radius: 10px;"
    >
      <a href="/"><span>Home</span> </a>
    </div>
    <div class="menu-item dropdown border border-warning bg-dark p-2">
      <span class="dropbtn text-warning" onclick="toggleMenu(this)"
        >Sections <i class="fas fa-angle-down"></i
      ></span>
      <div
        class="dropdown-content p-2 bg-dark2 mt-2 rounded w-auto mt-1 d-none"
        style="min-width: 200px;"
      >
        <ul class="list-unstyled">
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/myblog/">Blog Posts</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/bio/">About Me</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/site/">My Policy on AI</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/reads/">Recommended Reads</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/info/">Tech Stuff</a>
          </li>
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
    <div class="menu-item border border-warning bg-dark p-2">
      <a
        href="/alltaxa/"
        ><span>Search</span>
      </a>
    </div>
    <div class="menu-item border border-warning bg-dark p-2"
    style="border-top-right-radius: 10px; border-bottom-right-radius: 10px;">
      <a
        href="/archive/"
        ><span>Archive</span>
      </a>
    </div>
  </div>
</nav>

      <main>
        
<article class="border rounded p-3 position-relative" style="margin-top: 2.5em;">
  <div class="header">
    <h1 style="font-size: 2.5em;">
      Dual-booting Asahi Linux on your Apple Silicon Mac
    </h1>
    <div
    class="mb-1 mr-3 pl-1 pr-1 rounded bg-dark"
    style="position: absolute; top: -19px; font-size: 0.9em;"
  >
    <time>2022-07-14</time>    
    <span
      class="more"
      style="font-size: 1.5em;"
      title="Show Metadata"
      onclick="showMetadata(this)"
    >
      &#43;
    </span>
  </div><div class="m-2 metadata overflow-hidden" style="max-height: 0px;">
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-sections">
    <div>
      Reading Time: 
8 mins
      
    </div>
    <div>
      Section:
      <a
        class="pl-1 pr-1 rounded border border-secondary"
        href="/myblog"
        title="Section"
      >Blog Posts</a>
    </div>
  </div>
  

  
  
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-categories">
    Categories:
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/categories/blog"
      title="categories"
    >blog</a>
    
  </div>
  
  
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-tags">
    Tags:
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/tech"
      title="tags"
    >tech</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/development"
      title="tags"
    >development</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/programming"
      title="tags"
    >programming</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/unix"
      title="tags"
    >UNIX</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/linux"
      title="tags"
    >Linux</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/it"
      title="tags"
    >IT</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/computing"
      title="tags"
    >computing</a>
    
  </div>
  
  
</div>
</div>
  <div class="article pb-3 pt-3 border-bottom border-top">
    
    <p><img src="Asahi_M1.jpeg#right" alt="Asahi M1" title="Asahi M1"></p>
<h1 id="what-is-asahi-linux">What is Asahi Linux?</h1>
<p>Asahi (<a href="https://asahilinux.org/">https://asahilinux.org/</a>) is a Linux distribution based on Arch Linux ARM that you can install natively on Apple Silicon Macs with an M1- or M2-based CPU. I&rsquo;ve been using it daily as a software development workstation for over 3 months now on an M1 Mac Mini (16GB RAM, 500GB SSD), and it&rsquo;s <em><strong>unbelievably</strong></em> fast. It is 100% funded by Patreon and developed full-time by Hector Martin with many other contributors. You can watch <a href="https://twit.tv/shows/floss-weekly/episodes/680" title="this interview">this interview</a> to learn more about the project, or <a href="https://www.youtube.com/watch?v=igYgGH6PnOw" title="this video">this video</a> to learn how the Apple Silicon platform is reverse-engineered.</p>
<h1 id="what-doesnt-work-yet">What doesn’t work yet?</h1>
<p>While all the important hardware drivers necessary to use Asahi as a graphical workstation have been created (NVMe storage, keyboard, trackpad, Wi-Fi, Ethernet, USB, etc.), there are still some hardware components haven&rsquo;t been reverse-engineered yet. Similarly, some software packages have yet to be modified to support Apple Silicon. Following is a list of what does not currently work:</p>
<ul>
<li>GPU acceleration. Since the GPU driver is still being developed, all graphics are CPU-generated. This also means you are limited to using the default (optimal) monitor resolution, which isn&rsquo;t a big deal for most people.</li>
<li>Thunderbolt and external HDMI on MacBooks (HDMI works on the Mac Mini and is what I use with my monitor).</li>
<li>Sound. There is a working sound driver but the Asahi team is waiting for kernel-level volume caps and a declarative PipeWire framework with standard sound profiles so that there is zero chance you could accidentally blow the speakers on your MacBook (laptop speakers are fragile). While the external sound jack works fine on my Mac Mini, I instead listen to my phone playlist using Bose QC45 headphones while working.</li>
<li>Apps that don’t support the M1’s 16K page size. This list was very small when Asahi was first released and is even smaller now. Chromium was my only desired app that didn&rsquo;t support 16K pages back then (I had to use Firefox), but that was fixed with the Chromium 102 update in May.</li>
</ul>
<h1 id="what-software-do-i-run-on-asahi">What software do I run on Asahi?</h1>
<p>While Asahi ships with the KDE Plasma desktop by default, I primarily use GNOME and i3-gaps (both are shown below). Chromium is my main Web browser and Kate is my primary code editor (similar to Visual Studio Code). I also use many different developer frameworks and tools (Java, JavaScript, Python, PostgreSQL, Git, Docker, K3s, and Ansible), as well as several other miscellaneous apps (Hugo, LibreOffice, Gimp, Inkscape and Remmina).</p>
<p><img src="Asahi_GNOME1.png#center" alt="Asahi GNOME 1" title="Asahi GNOME 1"></p>
<p><img src="Asahi_i3_1.png#center" alt="Asahi i3 1" title="Asahi i3 1"></p>
<h1 id="how-fast-is-asahi">How fast is Asahi?</h1>
<p>Even with CPU-generated graphics, desktop environments and apps are lightning fast. I&rsquo;ve never seen KDE, GNOME, LibreOffice, Gimp, Inkscape, Chromium and Firefox run so fast before. Even games such as SuperTuxKart run smoothly, as does high-definition video using VLC. Website embedded video (e.g., YouTube) also runs perfectly.</p>
<p>For non-graphical tasks, the performance of Asahi on the M1 is even more impressive. Compiling Chromium (build 102) takes just over 1 hour in Fedora Linux on my Core i9 system, but only takes 12 minutes in Asahi. Similarly, Hugo composites this website 2 times faster in Asahi than the same build of Hugo in macOS on the same Mac Mini system. My Docker development containers and K3s Kubernetes cluster also run much, much faster in Asahi compared to macOS on the same system. This makes sense, because to run containers in macOS, macOS must run them in a Linux virtual machine while Asahi can run them natively.</p>
<p>CPU usage is spread across all 8 CPU cores and rarely rises above 20%, even with a dozen or more graphical apps open as well as many background services and containers running. With my workload, RAM usage is consistently between 2GB and 4GB in total, which is also much less than what I had with the same workload in macOS on the same system.</p>
<h1 id="can-asahi-run-virtual-machines">Can Asahi run virtual machines?</h1>
<p>Yes, using QEMU (provided you install the necessary QEMU packages first). Following is an Ubuntu 20.04 (ARM) virtual machine running in QEMU on the GNOME desktop:</p>
<p><img src="Asahi_GNOME_VM.png#center" alt="Asahi GNOME VM" title="Asahi GNOME VM"></p>
<h1 id="is-this-legal-and-safe-to-use">Is this legal and safe to use?</h1>
<p>Yes. Apple formally allows booting third-party operating systems on Apple Silicon Macs. When asked whether the ARM version of Windows 11 would be available to dual-boot on Apple Silicon, Apple&rsquo;s response was that &ldquo;it was up to Microsoft to decide whether to support that.&rdquo; Shortly after the Asahi project started, Apple even added a raw image mode to prevent macOS updates from breaking the boot process for third-party operating systems. This provided no benefit to macOS whatsoever; it merely served to help third-party operating system development.</p>
<p>Moreover, installing Asahi does not alter the security of macOS. During an Asahi install, Apple’s <em><strong>System Integrity Protection (SIP)</strong></em> is disabled, but only for Asahi as it provides no useful function outside macOS (Linux has its own equivalent security frameworks). SIP remains enabled for macOS, which you can verify if you boot into macOS and run the <code>csrutil status</code> command at a command prompt within the Terminal app.</p>
<h1 id="how-do-i-install-asahi">How do I install Asahi?</h1>
<p>Unlike installing Linux on other systems, you don&rsquo;t boot your system from a Linux installation ISO image written to a USB key or DVD. Instead, you run an installation script from macOS that prepares your system for dual-booting with Asahi, downloads the Asahi packages from a Linux repository, and downloads a second copy of the proprietary macOS firmware from Apple (to satisfy Apple&rsquo;s strict boot requirements on Apple Silicon, third-party operating systems must initially pretend to be a particular version of macOS with that macOS’s firmware at boot time).</p>
<p>To start an Asahi installation, you run the following command (underlined in red) at a command prompt within the macOS Terminal app.</p>
<p><img src="1.png#center" alt="Asahi Install 1" title="Asahi Install 1"></p>
<p>This will start the Asahi install script, display the storage used by macOS (in my case 494.38 GB), and allow you to resize it down to a smaller size to make room for Asahi.</p>
<p><img src="2.png#center" alt="Asahi Install 2" title="Asahi Install 2"></p>
<p>I chose to resize my macOS installation down to 400 GB, leaving 94.39 GB available for installing Asahi.</p>
<p><img src="3.png#center" alt="Asahi Install 3" title="Asahi Install 3"></p>
<p>You can then choose to install the Asahi operating system into that free space, as well as select one of 3 installation options:</p>
<ul>
<li>Option 1 (what I chose) installs Asahi Linux and the KDE Plasma Desktop (I also installed GNOME and i3-gaps after installation).</li>
<li>Option 2 installs a command-line version of Asahi, which requires that you manually install a desktop of your choice after installation.</li>
<li>Option 3 installs the components needed to boot any ARM-based Linux distribution (e.g., Fedora ARM) with a kernel that includes the drivers made by the Asahi team. This environment includes the m1n1 bootloader/hypervisor component created by the Asahi team, as well as the U-Boot universal ARM bootloader and the EFI System Partition.</li>
</ul>
<p><img src="4.png#center" alt="Asahi Install 4" title="Asahi Install 4"></p>
<p>Next, you select how much of the free space you&rsquo;d like to use to install Asahi (I chose the default, which uses the maximum), as well as the name of your Asahi installation. This name is shown on the Mac startup options screen.</p>
<p><img src="5.png#center" alt="Asahi Install 5" title="Asahi Install 5"></p>
<p>Following this, Asahi Linux and the macOS firmware will be downloaded and installed (this took about 30 minutes for me but will vary based on your Internet connection speed).</p>
<p><img src="6.png#center" alt="Asahi Install 6" title="Asahi Install 6"></p>
<p>Finally, the installation advises you to shut down your system and start it up while holding the Power button. Holding the Power button on a Mac at boot forces it to enter the Mac startup options screen, where you can choose to boot into Asahi Linux (instead of macOS). The first time you boot into Asahi, you&rsquo;ll complete a short Asahi configuration wizard to complete the installation.</p>
<p><img src="7.png#center" alt="Asahi Install 7" title="Asahi Install 7"></p>
<p>After installing Asahi, your system will boot to Asahi by default, but you can hold the Power button at boot to enter the Mac startup options screen and choose the option to boot into macOS. To make the system boot into macOS by default, simply press the Option key (or Alt key if you are using a Windows keyboard) when selecting macOS at the Mac startup options screen.</p>
<p>To see how Asahi modified your storage following installation, you can boot into macOS at the Mac startup options screen and run the <code>disktuil list</code> command at a command prompt in the Terminal app. Before Asahi was installed on my system, the output of <code>diskutil list</code> showed the following NVMe disk (/dev/disk0) with three partitions.</p>
<ul>
<li>Partition 1 contains Apple boot files.</li>
<li>Partition 2 (underlined in red) spans most of the disk (494.4 GB) and is synthesized into a virtual disk (/dev/disk4) that contains the logical volumes that comprise macOS.</li>
<li>Partition 3 contains the macOS Recovery files.</li>
</ul>
<p><img src="8.png#center" alt="Storage Before Asahi" title="Storage Before Asahi"></p>
<p>After Asahi installation, partition 3 is renamed to partition 6 and contains the macOS Recovery files. Partition 2 (underlined in red) is now only 400 GB and synthesized to /dev/disk3, while a new partition 3 (underlined in blue) is synthesized to /dev/disk4 and hosts the macOS firmware needed to access partition 4 and 5 (underlined in green). Partition 4 is the Asahi EFI system partition that allows the system to start the Linux kernel and access the Asahi root filesystem on partition 5.</p>
<p>Together, partitions 3, 4 and 5 comprise the 94.39 GB that I freed up for Asahi Linux during installation. If you remove those three partitions and resize partition 2 back to 494.4 GB, you will restore your system to its original state.</p>
<p><img src="9.png#center" alt="Storage After Asahi" title="Storage After Asahi"></p>

  </div>
  <div class="mt-4 d-flex flex-row justify-content-around">
  <div>
    <a
      href="/myblog/linux-certification/"
      data-toggle="tooltip"
      data-placement="top"
      title="How Linux Certification Has Evolved Over The Years"
      ><i class="fas fa-chevron-circle-left" style="font-size: 2em;"></i></a
    >
  </div>
  <div>
    <a
      href="/myblog/the-power-of-swag/"
      data-toggle="tooltip"
      data-placement="top"
      title="The Power of Swag in the Tech Industry"
      ><i class="fas fa-chevron-circle-right" style="font-size: 2em;"></i></a
    >
  </div>
</div>
<script src="https://giscus.app/client.js"
          data-repo="jasoneckert/jasoneckert.github.io"
          data-repo-id="MDEwOlJlcG9zaXRvcnkyMzUyMTE1MTk="
          data-category="Announcements"
          data-category-id="DIC_kwDODgUK_84ChWDV"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="preferred_color_scheme"
          data-lang="en"
          crossorigin="anonymous"
          async>
       </script>


</article>
<script>
  let showMetadata = function(x) {
    let elem = x.parentNode.nextElementSibling;
    if (window.getComputedStyle(elem)["height"] === "0px") {
      elem.style.maxHeight = elem.scrollHeight + "px";
      x.innerHTML = "&times;";
      x.title = "Hide Metadata";
    } else {
      elem.style.maxHeight = "0px";
      x.innerHTML = "&#43;";
      x.title = "Show Metadata";
    }
  };
</script>


      </main>
    </div>
    <footer>
  <div class="w-60 bg-danger ml-auto mr-auto mt-4" style="height: 4px;"></div>
  <div class="mt-0 mb-0" style="font-size: 1.7em;">
    <p class="text-center">
      WARNING: FULL FRONTAL NERDITY (tech-challenged persons strongly cautioned) 
    </p>
  </div>
</footer>

  </body>
</html>
