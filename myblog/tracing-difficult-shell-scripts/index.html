<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title>Jason Eckert&#39;s Website and Blog</title>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta name="description" content="My personal website and blog" />
  <meta name="author" content="Jason Eckert" />
  <meta name="generator" content="Jason Eckert Hugo 0.111.3" />

  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Overlock|Roboto+Mono&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/mero.css" />

  <script src="/js/mero.js"></script>
</head>

  <body class="bg-dark text-white m-auto" style="width:95%; max-width: 1024px;">
    <div class="wrapper">
      <nav class="mb-3 mt-3 ml-1">
  <div class="d-flex flex-row">
    <div
      class="menu-item border border-warning bg-dark p-2"
      style="border-top-left-radius: 10px; border-bottom-left-radius: 10px;"
    >
      <a href="/"><span>Home</span> </a>
    </div>
    <div class="menu-item dropdown border border-warning bg-dark p-2">
      <span class="dropbtn text-warning" onclick="toggleMenu(this)"
        >Sections <i class="fas fa-angle-down"></i
      ></span>
      <div
        class="dropdown-content p-2 bg-dark2 mt-2 rounded w-auto mt-1 d-none"
        style="min-width: 200px;"
      >
        <ul class="list-unstyled">
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/myblog/">Blog Posts</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/bio/">About Me</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/reads/">Recommended Reads</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/info/">Tech Stuff</a>
          </li>
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
    <div class="menu-item border border-warning bg-dark p-2">
      <a
        href="/alltaxa/"
        ><span>Search</span>
      </a>
    </div>
    <div class="menu-item border border-warning bg-dark p-2"
    style="border-top-right-radius: 10px; border-bottom-right-radius: 10px;">
      <a
        href="/archive/"
        ><span>Archive</span>
      </a>
    </div>
  </div>
</nav>

      <main>
        
<article class="border rounded p-3 position-relative" style="margin-top: 2.5em;">
  <div class="header">
    <h1 style="font-size: 2.5em;">
      Tracing difficult shell scripts
    </h1>
    <div
    class="mb-1 mr-3 pl-1 pr-1 rounded bg-dark"
    style="position: absolute; top: -19px; font-size: 0.9em;"
  >
    <time>2020-08-06</time>    
    <span
      class="more"
      style="font-size: 1.5em;"
      title="Show Metadata"
      onclick="showMetadata(this)"
    >
      &#43;
    </span>
  </div><div class="m-2 metadata overflow-hidden" style="max-height: 0px;">
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-sections">
    <div>
      Reading Time: 
7 mins
      
    </div>
    <div>
      Section:
      <a
        class="pl-1 pr-1 rounded border border-secondary"
        href="/myblog"
        title="Section"
      >Blog Posts</a>
    </div>
  </div>
  

  
  
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-categories">
    Categories:
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/categories/blog"
      title="categories"
    >blog</a>
    
  </div>
  
  
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-tags">
    Tags:
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/tech"
      title="tags"
    >tech</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/computing"
      title="tags"
    >computing</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/linux"
      title="tags"
    >Linux</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/unix"
      title="tags"
    >UNIX</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/sysadmin"
      title="tags"
    >sysadmin</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/it"
      title="tags"
    >IT</a>
    
  </div>
  
  
</div>
</div>
  <div class="article pb-3 pt-3 border-bottom border-top">
    
    <p><img src="comic.png#right" alt="UNIX/Linux comic" title="UNIX/Linux comic"></p>
<p>Whether you&rsquo;re an IT systems administrator, developer or devop working with Linux/UNIX shell scripts, you&rsquo;re likely going to come across some that are not well documented and difficult to trace (read and understand) as a result.</p>
<p>While these scripts discourage others from tracing them, you can easily trace even the most difficult shell scripts if you follow good tracing procedures. Moreover, by tracing a difficult shell script, you build your knowledge of specific Linux/UNIX components, as well as scripting in general.</p>
<p>To demonstrate this, let&rsquo;s trace an undocumented <code>treed</code> shell script that I made several decades ago for my students. If you execute this shell script, it performs a hierarchical listing of the contents of a directory name that you must specify as an argument (much like the MS-DOS <code>tree</code> command that has no equivalent on Linux/UNIX systems). If you execute it without supplying an argument, it returns usage information as shown below:</p>
<pre tabindex="0"><code>$ ./treed
usage: ./treed directory
$
</code></pre><p>To view a list of files and subdirectories under the classfiles directory, you could run the script with the directory name as an argument:</p>
<pre tabindex="0"><code>$ ./treed classfiles
classfiles
|
|__ Miscellaneous
|   |__ mystery
|   |__ letter
|__ Poems
|   |__ Blake
|   |   |__ jerusalem
|   |   |__ tiger
|   |__ Shakespeare
|   |   |__ sonnet5
|   |   |__ sonnet2
|   |   |__ sonnet3
|   |   |__ sonnet4
|   |   |__ sonnet1
|   |__ Yeats
|   |   |__ mooncat
|   |   |__ old
|   |   |__ whitebirds
|   |__ rhyme
|   |__ nursery
|   |__ twister
|__ proposal1
|__ proposal2

$ 
</code></pre><p>The classfiles directory shown above contains two files (proposal1 and proposal2) as well as two subdirectories. The Miscellaneous subdirectory contains two files (mystery and letter), and the Poems subdirectory contains three files (rhyme, nursery and twister) as well as three subdirectories (Blake, Shakespeare and Yeats) with additional files.</p>
<p>Now, let&rsquo;s examine the contents of the shell script that produced these results:</p>
<pre tabindex="0"><code>:
[ $# -eq 0 ] &amp;&amp; {  
	echo &#34;usage: $0 directory&#34; &gt;&amp;2
	exit 1
}
base=$1
export base
echo &#34;$base&#34;
find $base -print | sed &#39;
	s:^&#39;$base&#39;:|:
	s:/\([^/]*\)$:?? \1:
	s:/[^ ?/]*:   |:g
	s:?:_:g
	&#39;
</code></pre><p>Were you able to trace it easily? If not, you&rsquo;re definitely not alone!
Let&rsquo;s examine some shell script tracing strategies that we can apply to this shell script.</p>
<h1 id="1-start-with-what-you-know">1. Start with what you know</h1>
<p>With a basic knowledge of shell scripting from a course or other learning resource, you&rsquo;ve likely learned about standard input/output redirection, positional parameters (shell script command line arguments), as well as <code>if</code> statements their equivalent conditional ANDs and ORs. Thus, you&rsquo;ll probably be able to easily trace the following part of the shell script that tests whether the number of positional parameters (<code>$#</code>) is equal to zero AND (<code>&amp;&amp;</code>) prints a usage line to the screen using standard error (<code>&gt;&amp;2</code>) if this is the case, stopping the shell script with a false exit status (<code>exit 1</code>):</p>
<pre tabindex="0"><code>[ $# -eq 0 ] &amp;&amp; {  
	echo &#34;usage: $0 directory&#34; &gt;&amp;2
	exit 1
}
</code></pre><p>You&rsquo;ve also likely learned about variables, so you know that <code>$0</code> stores the shell script name, <code>$1</code> stores the first positional parameter, and that the following code copies the first positional parameter to a new variable called <code>base</code> that is made available to other commands run by the shell (<code>export base</code>) and also printed to the screen via standard output using the <code>echo</code> command (the first line you see when executing the shell script):</p>
<pre tabindex="0"><code>base=$1
export base
echo &#34;$base&#34;
</code></pre><p>So, by focusing on your existing basic shell script knowledge, you can trace the code that produces usage information if you don&rsquo;t supply an argument to the shell script, as well as trace the code that prints the top of the directory listing in the shell script output.</p>
<h1 id="2-research-specific-command-usage">2. Research specific command usage</h1>
<p>The next part of the shell is the hardest to trace as it leverages two powerful Linux/UNIX commands: <code>find</code> and <code>sed</code> (the stream editor). The <code>find</code> command is fairly common knowledge for any Linux/UNIX user, so you&rsquo;ll be able to identify that the following line generates a recursive list of files and subdirectories starting from the directory supplied as an argument to the shell script (the <code>$base</code> variable) and sends that recursive list to the <code>sed</code> command for processing via a pipe (<code>|</code>)</p>
<pre tabindex="0"><code>find $base -print | sed &#39;
</code></pre><p>Where it likely gets difficult to trace for most people is in the single-quoted, multi-line argument that follows the <code>sed</code> command:</p>
<pre tabindex="0"><code>find $base -print | sed &#39;
	s:^&#39;$base&#39;:|:
	s:/\([^/]*\)$:?? \1:
	s:/[^ ?/]*:   |:g
	s:?:_:g
	&#39;
</code></pre><p>This isn&rsquo;t about knowing shell scripting per se, but instead understanding the complex usage of a command that is used within the shell script (there are hundreds of such tools). Of course, you&rsquo;ll need to spend some time looking through manual page (<code>man sed</code>) or some examples online. While it may take you several minutes (maybe even an hour or more) to learn how <code>sed</code> is used here, you&rsquo;ll also be learning a powerful tool that you can use in other shell scripts for processing data using search-and-replace statements. Basically the old Linux/UNIX saying <em><strong>He said. She said. We all said &ldquo;Use sed&rdquo;</strong></em> ;-)</p>
<p>After researching <code>sed</code> usage, you&rsquo;ll learn that <code>s</code> stands for search, and the first character after <code>s</code> is the delimiter for each statement (<code>:</code> in this case). The first <code>sed</code> command searches for lines that start with <code>$base</code>, and replaces them with a pipe (<code>|</code>) character:</p>
<pre tabindex="0"><code>	s:^&#39;$base&#39;:|:
</code></pre><p>The second <code>sed</code> command matches patterns starting with a <code>/</code>, with anything but a slash (<code>[^/]</code>) in the middle, and ending with End-of-Line character (<code>$</code>) - this represents a filename. Next, it prepends a <code>?? </code> to this filename as a marker for the third <code>sed</code> command:</p>
<pre tabindex="0"><code>	s:/\([^/]*\)$:?? \1:
</code></pre><p>The third <code>sed</code> command matches patterns starting with a <code>/</code>, until the next space, <code>?</code> or <code>/</code> character. It then replaces this pattern globally throughout each line (<code>g</code>) with 3 spaces and a pipe, (<code>|</code>). This recursively strips parent directories from each line but their own, replacing them with pipe symbols.</p>
<pre tabindex="0"><code>	s:/[^ ?/]*:   |:g
</code></pre><p>And the fourth <code>sed</code> command replaces all <code>?</code> characters with underscore (<code>_</code>) characters, globally throughout each line:</p>
<pre tabindex="0"><code>	s:?:_:g
</code></pre><h1 id="3-verify-your-trace-using-script-output-or-functionality">3. Verify your trace using script output or functionality</h1>
<p>After tracing enough of your script, make sure you correlate it to the actual functionality of the script, which can often be achieved by examining the output generated by the script, or the tasks that the script performs. After printing the <code>$base</code> variable to the screen in our example, the <code>sed</code> command modified the output of a recursive <code>find</code> listing by replacing directories at the beginning of the hierarchy with spaces, pipe symbols and underscore characters (via a <code>??</code> placeholder).  You can easily verify your trace logic by examining the classfiles directory output generated by the script.</p>
<p>Furthermore, certain things you didn&rsquo;t know can easily be deduced by examining the output of a script. For example, if you didn&rsquo;t know what <code>$0</code> represented, you could run the script without arguments to see the message generated, and then compare it to the script contents to see that it represents the script path.</p>
<h1 id="4-identify-the-purpose-of-any-remaining-script-syntax">4. Identify the purpose of any remaining script syntax</h1>
<p>Sometimes shell scripts contain syntax with associated functionality that isn&rsquo;t immediately clear when tracing the shell script. In our example, the <code>:</code> at the beginning of the shell script serves no visible function. This <code>:</code> is functionally the same as the <code>/bin/true</code> command in that it generates a true exit status, and nothing more.  Normally a shell script starts with a hashpling/shebang such as <code>#!/bin/bash</code> to tell the executing shell interpret all remaining lines using a BASH shell. However, starting a script with a <code>:</code> was  common practice on old UNIX systems. It was a way to identify scripts that could safely execute in any shell on the system.</p>
<p>Another example of this is using standard output redirection following a code block (e.g. an <code>if</code> statement block). This syntax forces the standard output of all commands in the code block to a single file.</p>
<p>Regardless, any remaining script syntax can be easily Googled and committed to memory for future use!</p>

  </div>
  <div class="mt-4 d-flex flex-row justify-content-around">
  <div>
    <a
      href="/myblog/open-does-not-always-mean-open-source/"
      data-toggle="tooltip"
      data-placement="top"
      title="Open does not always mean Open Source"
      ><i class="fas fa-chevron-circle-left" style="font-size: 2em;"></i></a
    >
  </div>
  <div>
    <a
      href="/myblog/so-you-think-online-conferencing-is-new/"
      data-toggle="tooltip"
      data-placement="top"
      title="So, you think online conferencing is new?"
      ><i class="fas fa-chevron-circle-right" style="font-size: 2em;"></i></a
    >
  </div>
</div>

</article>
<script>
  let showMetadata = function(x) {
    let elem = x.parentNode.nextElementSibling;
    if (window.getComputedStyle(elem)["height"] === "0px") {
      elem.style.maxHeight = elem.scrollHeight + "px";
      x.innerHTML = "&times;";
      x.title = "Hide Metadata";
    } else {
      elem.style.maxHeight = "0px";
      x.innerHTML = "&#43;";
      x.title = "Show Metadata";
    }
  };
</script>


      </main>
    </div>
    <footer>
  <div class="w-60 bg-danger ml-auto mr-auto mt-4" style="height: 4px;"></div>
  <div class="mt-0 mb-0" style="font-size: 1.9em;">
    <p class="text-center">
      WARNING: FULL FRONTAL NERDITY 
    </p>
  </div>
  <div class="mt-0 mb-0" style="font-size: 1.0em;">
    <p class="text-center">
      (Tech-challenged persons strongly cautioned) 
    </p>
  </div>
</footer>

  </body>
</html>
