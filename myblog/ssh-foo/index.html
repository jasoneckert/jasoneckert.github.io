<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title>Jason Eckert&#39;s Website and Blog</title>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta name="description" content="My personal website and blog" />
  <meta name="author" content="Jason Eckert" />
  <meta name="generator" content="Jason Eckert Hugo 0.119.0" />

  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Overlock|Roboto+Mono&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/mero.css" />

  <script src="/js/mero.js"></script>
</head>

  <body class="bg-dark text-white m-auto" style="width:95%; max-width: 1024px;">
    <div class="wrapper">
      <nav class="mb-3 mt-3 ml-1">
  <div class="d-flex flex-row">
    <div
      class="menu-item border border-warning bg-dark p-2"
      style="border-top-left-radius: 10px; border-bottom-left-radius: 10px;"
    >
      <a href="/"><span>Home</span> </a>
    </div>
    <div class="menu-item dropdown border border-warning bg-dark p-2">
      <span class="dropbtn text-warning" onclick="toggleMenu(this)"
        >Sections <i class="fas fa-angle-down"></i
      ></span>
      <div
        class="dropdown-content p-2 bg-dark2 mt-2 rounded w-auto mt-1 d-none"
        style="min-width: 200px;"
      >
        <ul class="list-unstyled">
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/myblog/">Blog Posts</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/bio/">About Me</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/reads/">Recommended Reads</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="https://jasoneckert.github.io/info/">Tech Stuff</a>
          </li>
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
    <div class="menu-item border border-warning bg-dark p-2">
      <a
        href="/alltaxa/"
        ><span>Search</span>
      </a>
    </div>
    <div class="menu-item border border-warning bg-dark p-2"
    style="border-top-right-radius: 10px; border-bottom-right-radius: 10px;">
      <a
        href="/archive/"
        ><span>Archive</span>
      </a>
    </div>
  </div>
</nav>

      <main>
        
<article class="border rounded p-3 position-relative" style="margin-top: 2.5em;">
  <div class="header">
    <h1 style="font-size: 2.5em;">
      SSH Foo
    </h1>
    <div
    class="mb-1 mr-3 pl-1 pr-1 rounded bg-dark"
    style="position: absolute; top: -19px; font-size: 0.9em;"
  >
    <time>2018-12-09</time>    
    <span
      class="more"
      style="font-size: 1.5em;"
      title="Show Metadata"
      onclick="showMetadata(this)"
    >
      &#43;
    </span>
  </div><div class="m-2 metadata overflow-hidden" style="max-height: 0px;">
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-sections">
    <div>
      Reading Time: 
4 mins
      
    </div>
    <div>
      Section:
      <a
        class="pl-1 pr-1 rounded border border-secondary"
        href="/myblog"
        title="Section"
      >Blog Posts</a>
    </div>
  </div>
  

  
  
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-categories">
    Categories:
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/categories/blog"
      title="categories"
    >blog</a>
    
  </div>
  
  
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-tags">
    Tags:
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/tech"
      title="tags"
    >tech</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/computing"
      title="tags"
    >computing</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/linux"
      title="tags"
    >Linux</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/unix"
      title="tags"
    >UNIX</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/sysadmin"
      title="tags"
    >sysadmin</a>
    
    <a
      class="pl-1 pr-1 rounded border border-secondary"
      href="/tags/it"
      title="tags"
    >IT</a>
    
  </div>
  
  
</div>
</div>
  <div class="article pb-3 pt-3 border-bottom border-top">
    
    <p>Last week, I gave a presentation at a local LUG (which is a Linux User’s Group, for anyone who hasn’t heard of those before) on the subject of SSH Foo.</p>
<p>In UNIX circles, we refer to tricks of the trade as “Kung Fu” or just “Fu” (which sounds rude), so it is spelled “Foo” ;-)</p>
<p>In this blog post, I’ll summarize my SSH Foo talk! Be aware that this is not an introduction  to SSH, but a more advanced look at some interesting SSH features for those who are already comfortable with it. As such, I&rsquo;ve kept to point form here to allow you to  skim to the parts you are most interested in!</p>
<h1 id="part-1---cryptography-basics">Part 1 - Cryptography Basics:</h1>
<p>Symmetric cryptography (e.g. AES/Blowfish/RC4):</p>
<ul>
<li>Fast for encrypting payloads of data</li>
<li>However, negotiating the symmetric key across a network is difficult</li>
<li>Clients usually generate a symmetric key and encrypt it asymmetrically to get it to a server across a network</li>
</ul>
<p><img src="ssh1.jpg#center" alt="ssh1" title="ssh1"></p>
<p>Asymmetric cryptography (e.g. RSA/DSA/ECC):</p>
<p><img src="ssh2.jpg#center" alt="ssh2" title="ssh2"></p>
<h1 id="part-2---ssh-basics">Part 2 - SSH Basics:</h1>
<ul>
<li>Encrypted telnet (telnet towel.blinkenlights.nl) but without Star Wars</li>
<li>Uses symmetric encryption for all payload data</li>
<li>Uses asymmetric encryption to protect symmetric key generated by the SSH client</li>
</ul>
<p><img src="ssh3.jpg#center" alt="ssh3" title="ssh3"></p>
<ul>
<li>
<p>Symmetric encryption controlled by client</p>
<pre><code>  /etc/ssh/ssh_config   
      Ciphers (usually AES*)
</code></pre>
</li>
<li>
<p>Asymmetric encryption controlled by server (the host keys):</p>
<pre><code>  /etc/ssh/sshd_config
      HostKey /etc/ssh/ssh_host_rsa_key (&amp; .pub)
      HostKey /etc/ssh/ssh_host_ecdsa_key (&amp; .pub)
      HostKey /etc/ssh/ssh_host_ed25519_key (&amp; .pub)
  ~/.ssh/known_hosts
</code></pre>
</li>
</ul>
<h1 id="part-3---ssh-user-keys">Part 3 - SSH User Keys:</h1>
<ul>
<li>
<p>You can also create asymmetric keys for your local user account and add these keys to each server you manage to avoid passwords</p>
<pre><code>  ssh-keygen
</code></pre>
</li>
<li>
<p>Do you want to protect your private key with passphrase? You’ll need it each time the private key is used unless you want to load a program that caches it, such as ssh-agent</p>
<pre><code>  cat ~/.ssh/id_rsa
  cat ~/.ssh/id_rsa.pub
  ssh-copy-id -i root@server1
  ssh root@server1 (look ma, no password!)
</code></pre>
</li>
<li>
<p>Many systems prevent root SSH in sshd_config (must connect as bob and su/sudo):</p>
<pre><code>  PermitRootLogins yes/no/without-password
</code></pre>
</li>
<li>
<p>If you want to omit the username for each host, you can use host-specific options on your SSH client to specify a default user:</p>
<pre><code>  cat ~/.ssh/config
     Host server1
     User admin
     Host server2
     User bob
</code></pre>
</li>
</ul>
<h1 id="part-4---ssh-file-copy">Part 4 - SSH File Copy:</h1>
<ul>
<li>
<p>Copy remote /root/lala file (on server1) to local /var directory</p>
<pre><code>  ssh root@server1 cat /root/lala &gt; /var/sample
  scp root@server1:/root/lala /var
</code></pre>
</li>
<li>
<p>Copy the local /root/lala file to /var directory on remote computer (server1)</p>
<pre><code>  ssh root@server1 cat &lt;/root/lala &quot;&gt;&quot; /var/lala
  scp /root/lala root@server1:/var
</code></pre>
</li>
<li>
<p>Can also use piping</p>
<pre><code>  dd if=/root/lala | ssh -C user@host dd of=/var/lala
</code></pre>
</li>
<li>
<p>Works for anything, really</p>
<pre><code>  dd if=/dev/tty5 | ssh -C user@host dd of=/dev/tty2
</code></pre>
</li>
</ul>
<h1 id="part-5---tunnelling">Part 5 - Tunnelling:</h1>
<ul>
<li>
<p>Tunnelling X.org (requires xauth)</p>
<pre><code>  ssh –X root@server1
  gnome-control-center&amp;
</code></pre>
</li>
<li>
<p>Tunneling other stuff (e.g. VNC) can be done using one of two methods.</p>
</li>
<li>
<p>Method 1: Local tunneling – e.g. forward local traffic on port 5999 to server1 on port 5900 as bob:</p>
<pre><code>  ssh -L 5999:localhost:5900 bob@server1

  //After this, you can start a VNC viewer and connect to localhost:5999
  //to access the VNC server running on port 5900 on server1 through an
  //SSH tunnel
</code></pre>
</li>
<li>
<p>Method 2: Remote tunneling – e.g. bob on client1 can start a VNC viewer and connect to server1:5999 in order to access the VNC server running on port 5900 on server1 (your server) via SSH:</p>
<pre><code>  ssh -R 5999:server1:5900 bob@client1
</code></pre>
</li>
<li>
<p>Evading firewall restrictions with local tunneling:</p>
<pre><code>  ssh homeserver –L 443:lala.com:443

  cat /etc/hosts (127.0.0.1 lala.com)
  apachectl stop
  curl https://lala.com

  //General format (you are computerA): ssh computerB –L 443:computerC:443
</code></pre>
</li>
</ul>
<p><img src="ssh4.jpg#center" alt="ssh4" title="ssh4"></p>
<ul>
<li>
<p>Can also tell SSH to do SOCKS5 proxy forwarding to a home server to evade a firewall:</p>
<pre><code>  ssh -D 8080 homeserver

  //Set Chrome/Firefox proxy address to localhost:8080
  //DNS requests are not part of this (you can tunnel DNS through a SOCKS5 proxy
  //with other software like DNSCrypt or a Firefox plugin)
</code></pre>
</li>
<li>
<p>Problems?</p>
<pre><code>  grep Forwarding /etc/ssh/sshd_config
     X11Forwarding no
     AllowTcpForwarding no
</code></pre>
</li>
</ul>
<h1 id="part-6---sshfs-nfs-is-sooooo-yesterday">Part 6 - SSHFS (NFS is sooooo yesterday):</h1>
<ul>
<li>
<p>Access remote / filesystem on server1 over SSH session mounted to local /mnt directory:</p>
<pre><code>  dnf install sshfs
  sshfs root@server1:/ /mnt
  ls /mnt
  rm –Rf /mnt/* (--no-preserve-root bypassed)</code></pre>
</li>
</ul>

  </div>
  <div class="mt-4 d-flex flex-row justify-content-around">
  <div>
    <a
      href="/myblog/2018-in-review/"
      data-toggle="tooltip"
      data-placement="top"
      title="2018 in review"
      ><i class="fas fa-chevron-circle-left" style="font-size: 2em;"></i></a
    >
  </div>
  <div>
    <a
      href="/myblog/three-reasons-why-incubators-breed-failure/"
      data-toggle="tooltip"
      data-placement="top"
      title="Three reasons why incubators breed failure"
      ><i class="fas fa-chevron-circle-right" style="font-size: 2em;"></i></a
    >
  </div>
</div>

</article>
<script>
  let showMetadata = function(x) {
    let elem = x.parentNode.nextElementSibling;
    if (window.getComputedStyle(elem)["height"] === "0px") {
      elem.style.maxHeight = elem.scrollHeight + "px";
      x.innerHTML = "&times;";
      x.title = "Hide Metadata";
    } else {
      elem.style.maxHeight = "0px";
      x.innerHTML = "&#43;";
      x.title = "Show Metadata";
    }
  };
</script>


      </main>
    </div>
    <footer>
  <div class="w-60 bg-danger ml-auto mr-auto mt-4" style="height: 4px;"></div>
  <div class="mt-0 mb-0" style="font-size: 1.7em;">
    <p class="text-center">
      WARNING: FULL FRONTAL NERDITY (tech-challenged persons strongly cautioned) 
    </p>
  </div>
</footer>

  </body>
</html>
